# Task ID: 9
# Title: Fix Side Effects in Pure Functions
# Status: done
# Dependencies: None
# Priority: medium
# Description: Replace direct calls to Date.now() with Effect's proper time handling to maintain function purity.
# Details:
1. Replace direct Date.now() calls with Effect's time handling:
```typescript
import { Effect } from 'effect/Effect';
import { Stream } from 'effect/Stream';

const addTimestamp = (line: string) =>
  Effect.gen(function* (_) {
    const now = yield* _(Effect.clock.currentTimeMillis);
    return { timestamp: now, line };
  });

const streamLinesWithTimestamp = (command: Command.Command) =>
  streamLines(command).pipe(
    Stream.flatMap((line) => Stream.fromEffect(addTimestamp(line)))
  );
```
2. Update all time-dependent code to use Effect's clock
3. Use TestClock for deterministic testing
4. Document the approach to time handling

# Test Strategy:
1. Write tests using TestClock to verify timestamp generation
2. Test with fixed clock times to ensure deterministic results
3. Verify function purity by testing multiple invocations
4. Create tests that explicitly verify time handling
